#!/bin/bash
set -e
DOCKER_REPO=linuxserver/lidarr

bash .travis/listDockerTags ${DOCKER_REPO} | awk '/^[0-9]/ && /-ls/' > /tmp/${CONTAINER}.VERSIONS

# Set LATEST
sort -V /tmp/${CONTAINER}.VERSIONS | tail -n 1 > ${CONTAINER}.LATEST

# Add 1 missing to VERSIONS
ADDED=0
if [[ ! -e ${CONTAINER}.VERSIONS ]]; then
        touch ${CONTAINER}.VERSIONS
fi
for x in $( sort -V /tmp/${CONTAINER}.VERSIONS ); do
        if ! grep -q "^${x}$" ${CONTAINER}.VERSIONS; then
                if [[ ${ADDED} -eq 0 ]]; then
                        echo ${x} >> ${CONTAINER}.VERSIONS
                        ADDED=1
                else
                        break
                fi
        fi
done
if [[ -e /tmp/${CONTAINER}.VERSIONS ]]; then
	rm /tmp/${CONTAINER}.VERSIONS
fi
